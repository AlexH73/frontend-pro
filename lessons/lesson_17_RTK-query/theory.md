# Redux Persist ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å

## üìå –í–≤–µ–¥–µ–Ω–∏–µ

**Redux Persist** ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ Redux –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (localStorage, sessionStorage –∏–ª–∏ –¥—Ä—É–≥–æ–µ) –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –û–Ω–∞ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –≥–¥–µ –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å:

-   –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏,
-   –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
-   —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã,
-   —Ñ–∏–ª—å—Ç—Ä—ã,
-   –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

___

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Redux Persist

Redux Persist ¬´–æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç¬ª –∫–æ—Ä–Ω–µ–≤–æ–π —Ä–µ–¥—å—é—Å–µ—Ä —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `persistReducer` –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä—Å–∏—Å—Ç–æ—Ä (`persistor`), –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:

1.  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—É–∫–∞–∑–∞—Ç—å –∫–ª—é—á, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Ç.–¥.).
2.  –û–±–µ—Ä–Ω—É—Ç—å rootReducer —Å –ø–æ–º–æ—â—å—é `persistReducer`.
3.  –°–æ–∑–¥–∞—Ç—å `persistor` —á–µ—Ä–µ–∑ `persistStore(store)`.
4.  –û–±–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `PersistGate`.

___

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install redux-persist
# –∏–ª–∏
yarn add redux-persist
```

___

## üìÅ –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Redux Persist (—Å Redux Toolkit)

### **store.ts**

```ts
import { configureStore } from '@reduxjs/toolkit';
import storage from 'redux-persist/lib/storage'; // localStorage –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
import { persistReducer, persistStore } from 'redux-persist';
import thunk from 'redux-thunk';
import rootReducer from './rootReducer';

const persistConfig = {
  key: 'root',
  storage,
  whitelist: ['cart', 'user'], // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–∏ slice
};

const persistedReducer = persistReducer(persistConfig, rootReducer);

export const store = configureStore({
  reducer: persistedReducer,
  middleware: [thunk],
});

export const persistor = persistStore(store);
```

### **index.tsx**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import { Provider } from 'react-redux';
import { store, persistor } from './store';
import { PersistGate } from 'redux-persist/integration/react';

const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(
  <Provider store={store}>
    <PersistGate loading={<div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>} persistor={persistor}>
      <App />
    </PersistGate>
  </Provider>
);
```

___

## üöÄ –ß–∞—Å—Ç–∏—á–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: whitelist –∏ blacklist

Redux Persist –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å.

### **whitelist** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ slice:

```ts
whitelist: ['cart']
```

### **blacklist** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—ë, –∫—Ä–æ–º–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö:

```ts
blacklist: ['auth']
```
___

## üßº –û—á–∏—Å—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ logout).

### –°–ø–æ—Å–æ–± 1: –æ—á–∏—Å—Ç–∏—Ç—å storage –≤—Ä—É—á–Ω—É—é
```ts
persistor.purge();
```

### –°–ø–æ—Å–æ–± 2: –æ—á–∏—Å—Ç–∏—Ç—å —á–∞—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ reducers

```ts
authSlice.actions.logout()
```

___

## üì¶ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ö—Ä–∞–Ω–∏–ª–∏—â

Redux Persist —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∞–¥–∞–ø—Ç–µ—Ä–∞–º–∏:

-   **localStorage** (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
-   **sessionStorage**
-   **AsyncStorage** (React Native)
-   **localForage** (IndexedDB)
-   **custom storage** (–ª—é–±–æ–π –≤–∞—à)

–ü—Ä–∏–º–µ—Ä —Å `localForage`:

```ts
import localForage from 'localforage';
const persistConfig = {
  key: 'root',
  storage: localForage,
};
```

___

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

### ‚úîÔ∏è –ü–ª—é—Å—ã

-   —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏;
-   –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è;
-   —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Redux Toolkit –∏ Thunk;
-   –≥–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

### ‚ùó –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –º–∏–Ω—É—Å—ã

-   –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–∏–µ –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö –≤ localStorage;
-   —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ–≤–∞—Ç—å –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
-   –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ –∫–ª–∞—Å—Å—ã.

___

## üìò –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

-   —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ **—Ç–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã–µ** —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è;
-   –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ storage —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã ‚Üí –ª—É—á—à–µ HttpOnly cookies);
-   –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `version` + `migrate` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è persisted state –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

___

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Redux Persist** ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è Redux –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç —É–ª—É—á—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –∏ —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –µ–≥–æ —Ç–∞–º, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã–º–∏, –∏ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
